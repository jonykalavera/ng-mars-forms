!function(){"use strict";angular.module("form.widgets",["ngTagsInput"])}(),function(){"use strict";function e(){return{restrict:"E",require:["^form","ngModel"],link:function(e,t,n,r){e.form=r[0]},bindToController:!0,controller:t,controllerAs:"dateInput",scope:{caption:"@caption",helpText:"@helpText",name:"@name",content:"=ngModel",dateInPast:"=dateInPast"},templateUrl:function(e,t){return t.templateUrl||"directives/partials/date.input.html"}}}function t(){var e=this;e.getClass=function(t,n){if(angular.isUndefined(t))return"";n=n||[],e.requires&&n.push("required");var r="";return angular.isDefined(n)&&angular.forEach(n,function(e){t.$error[e]&&(r="has-error")}),t.$touched&&!t.$valid?"has-error":r},e.openDatepicker=function(t){return angular.isDefined(t)&&(e._opened=!0),e._opened===!0},e.minDate=function(){return angular.isUndefined(e._minDate)&&!e.dateInPast&&(e._minDate=new Date),e._minDate}}angular.module("form.widgets").directive("dateInput",e)}(),function(){"use strict";function e(){return function(e,t){return t===!1?Object.keys(e).map(function(t){return e[t]}):Object.keys(e).map(function(t){return"object"==typeof e[t]?Object.defineProperty(e[t],"$key",{enumerable:!1,value:t}):void 0})}}function t(){function e(e,t,n){return e.map(function(e){return e[n]}).indexOf(t)}return function(t,n,r){return angular.isDefined(t)&&angular.isDefined(n)?(r=r||"resource_uri",n.map(function(n){var a=e(t,n[r],r);-1!==a&&t.splice(a,1)}),t):t}}angular.module("form.widgets").filter("toArray",e).filter("cleanObjects",t)}(),function(){"use strict";function e(e,n){return{restrict:"E",require:["^form","ngModel"],replace:!1,bindToController:!0,controller:t,controllerAs:"imageInput",link:function(t,r,a,i){t.form=i[0],t.$watch(function(){return t.imageInput.theImageContent},function(r){var i=!0;if(angular.isDefined(r)&&r instanceof File){t.form[a.name].$setValidity("required",!0);var o=angular.lowercase(r.type),l="image/jpg"!==o&&"image/jpeg"!==o&&"image/png"!==o;if(n.log("ext",o),n.log("is not valid?",l),l)throw t.form[a.name].$setValidity("required",!1),t.form[a.name].$error.message="Invalid image",i=!1,"Invalid image file"}else null===r&&t.form[a.name].$setValidity("required",!1);e(t.imageInput.setImageValidity)(i)})},scope:{browseText:"@browseText",caption:"@caption",name:"@name",imageThumbnail:"@imageThumbnail",theImageContent:"=ngModel",required:"=required",helpText:"@helpText"},templateUrl:function(e,t){return t.templateUrl||"directives/partials/image.input.html"}}}function t(e){var t=this;t.setImageValidity=function(e){t.validImage=e},t.uploadMe=function(n,r){if(angular.isUndefined(r)&&(r="image"),angular.isDefined(n)){var a=n[0];if(t.theImageContent=a,e.$apply(),t.validImage){var i=new FileReader;i.onloadend=function(n){var r=n.target.result.replace("data:"+t.theImageContent.type+";base64,","");t.theImageContent={filename:t.theImageContent.name,b64string:r,content_type:t.theImageContent.type,fileSize:t.theImageContent.size},e.$apply()};try{i.readAsDataURL(a)}catch(o){t.theImageContent=null,e.$apply()}}}}}function n(e,t){return{restrict:"A",link:function(e,n,r,a){n.bind("change",function(n){t(r.fileOnChange)(e,{files:n.target.files,field:r.name})})}}}angular.module("form.widgets").directive("fileOnChange",n).directive("imageInput",e)}(),function(){"use strict";function e(e,t){return{restrict:"A",link:function(n,r,a){var i=r[0];r.bind("scroll",function(){i.scrollTop+i.offsetHeight>i.scrollHeight&&(e.debug("loadmore..."),t(a.loadMore)(n))})}}}function t(e){function t(e,t){var n;angular.forEach(e,function(e){n=r(t,e,"resource_uri"),t.splice(n,1)})}function n(e,t,n){var a=r(e,t,n);return-1!==a?e[a]:null}function r(e,t,n){return e.map(function(e){return e[n]}).indexOf(t)}function a(e,t,r){var a;return r=r||[],angular.forEach(e,function(e){a=n(t,e,"resource_uri"),r.push(a)}),{to:r,from:t}}function i(e,t,n){var r=this;r.busy=!1,r.loadMore=function(){null===r.meta.next||r.busy||(r.busy=!0,n.get(r.meta.next).then(function(e){t.debug("More objects",e),r.objects=r.objects.concat(e.data.objects),r.meta=e.data.meta,r.busy=!1},function(e){t.error("Err loading more objects",e)}))},r.fakeContent=r.fakeContent||[],r.idField=r.idField||"resource_uri",r.master=r.master||[],r.leftDisabled=r.rightDisabled=!0,e.$watch(function(){return r.fakeContent},function(e){angular.isDefined(e)&&e.length>0?r.leftDisabled=!1:r.leftDisabled=!0}),e.$watchCollection(function(){return r.master},function(e){angular.isDefined(e)&&e.length>0?r.rightDisabled=!1:r.rightDisabled=!0})}return{restrict:"E",require:["^form","ngModel"],templateUrl:function(e,t){return t.templateUrl||"directives/partials/related.input.html"},bindToController:!0,controller:i,controllerAs:"related",link:function(n,r,i,o){n.form=o[0],r.on("click",function(r){var i=angular.element(r.target),o=n.related.master.length>0,l=angular.isDefined(n.related.fakeContent)&&n.related.fakeContent.length>0,u="btn btn-link glyphicon glyphicon-circle-arrow-right"===(i[0].className||""),c="btn btn-link glyphicon glyphicon-circle-arrow-left"===(i[0].className||"");if(angular.isDefined(i[0].className)){var s;u&&o&&(e.debug("isRigthClick",o),s=a(n.related.master,n.related.objects,n.related.content),e.debug("R",s),n.$apply(function(){n.related.content=s.to,n.related.objects=s.from,t(n.related.master,n.related.objects),n.related.master=[]})),c&&l&&(e.debug("isLeftClick",l),s=a(n.related.fakeContent,n.related.content,n.related.objects),e.debug("L",s),n.$apply(function(){n.related.content=s.from,n.related.objects=s.to,t(n.related.fakeContent,n.related.content),n.related.fakeContent=[]}))}})},scope:{caption:"@caption",meta:"=",objects:"=objects",content:"=ngModel",name:"@name",helpText:"@helpText",multiple:"=",idField:"@"}}}angular.module("form.widgets").directive("scrolly",e).directive("relatedInput",t)}(),function(){"use strict";function e(){return{restrict:"E",require:["^form","ngModel"],bindToController:!0,templateUrl:function(e,t){return t.templateUrl||"directives/partials/tags.input.html"},controller:t,controllerAs:"tags",scope:{caption:"=caption",displayProperty:"@displayProperty",placeholder:"@placeholder",tagsModel:"=ngModel",objects:"=objects"}}}function t(e){var t=this;t.loadTags=function(e){var n=[];return angular.forEach(t.objects,function(t){-1!==angular.lowercase(t.name).indexOf(angular.lowercase(e))&&n.push(t.name)}),n},e.$watchCollection(function(){return t.tagsModel},function(e){var n=[];angular.forEach(e,function(e){e["protected"]=!0,delete e.contents_count,n.push(e)}),t.tagsModel=n})}angular.module("form.widgets").directive("tags",e)}(),function(){"use strict";function e(){return{restrict:"E",require:["^form","ngModel"],replace:!0,link:function(e,t,n,r){e.form=r[0]},bindToController:!0,controller:t,controllerAs:"textInput",scope:{caption:"@caption",maxLength:"@maxlength",textArea:"=textArea",helpText:"@helpText",name:"@name",content:"=ngModel",regexValidator:"=regexValidator",requires:"=requires",type:"@type"},templateUrl:function(e,t){return t.templateUrl||"directives/partials/text.input.html"}}}function t(){var e=this;e.getClass=function(t,n){if(angular.isUndefined(t))return"";n=n||[],e.requires&&n.push("required");var r="";return angular.isDefined(n)&&angular.forEach(n,function(e){t.$error[e]&&(r="has-error")}),t.$touched&&!t.$valid?"has-error":r},e.openDatepicker=function(t){return angular.isDefined(t)&&(e._opened=!0),e._opened===!0},e.minDate=function(){return angular.isUndefined(e._minDate)&&!e.dateInPast&&(e._minDate=new Date),e._minDate}}angular.module("form.widgets").directive("textInput",e)}();